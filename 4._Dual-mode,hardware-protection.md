## 이중모드, 하드웨어 보호

### 1. 이중모드

- 한 컴퓨터를 여러 사람이 동시에 사용하는 환경 (서버 컴퓨터, ex. 수강 신청) 또는 한 사람이 여러 프로그램을 동시에 사용(ex. 스마트폰)하는 경우
- 한 사람이 여러 프로그램을 동시에 사용하는 환경에서는 한 사람의 행동이 프로그램 전체에 영향을 줄 수 있다. (실수, 또는 고의로 잘못된 명령을 입력했을 때 시스템이 다운되는 경우)

  **특권 명령어(privileged instructions) 종류** : STOP, HALT, RESET, SET_TIMER, SET_HW 등의

- 사용자 프로그램은 특별한 권한이 있는 명령(privileged instructions)을 사용 불가하게 해야한다. (일반 유저가 사용하지 못하게)

  **사용자(user) 모드(일반 user)** vs **관리자(supervisor) 모드**의 **이중모드(dual mode)**를 사용한다.

  관리자 모드(supervisor mode) = 시스템 모드(system mode) = 모니터 모드(monitor mode) = 특권 모드(privileged mode)

- **특권 명령(privileged instructions)** : 관리자 모드에서만 내릴 수 있는 명령 (일반 유저 X)  
  하드웨어의 값을 바꾸는 것도 일반 유저가 하면 안된다. -> 다른 유저에게 영향을 끼칠 수 있기 때문에

### 2. 이중모드는 어떻게 구현할 수 있는가?

- 이중 모드를 나타내는 비트를 추가, 레지스터 안에 있는 비트를 모니터 비트에 할당

  **모니터 비트**

  - 1 -> **시스템 모드(privileged instruction)**
  - 0 -> **user mode**

- cpu 내에는 레지스터, ALU, control unit 등 존재 -> 레지스터에 모드를 나타내는 flag 존재(flag - carry, overflow, zero, negative (0과 1로 기능이 정해짐)

|                 관리자 모드                  |              사용자 모드               |
| :------------------------------------------: | :------------------------------------: |
|          운영체제 서비스 실행될 때           |       사용자 프로그램 실행할 때        |
| 하드웨어 / 소프트웨어 인터럽트 발생하는 경우 | 운영체제 서비스가 끝나면 다시 돌아온다 |
